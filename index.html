<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title id="nav-title">Travel App Template</title>
   
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
   
    <style>
        /* =========================================
           1. 設計語言 (更換顏色與風格請改這裡)
           ========================================= */
        :root {
            --primary-bg: #3E3C3A; /* 主背景色 */
            --accent-color: #E95464; /* 強調色 (按鈕、標籤) */
            --card-bg: #E8E8E8; /* 卡片背景 */
            --text-dark: #2F2F2F; /* 深色文字 */
            --text-light: #FFFFFB; /* 淺色文字 */
            --nav-bg: #2B2A29; /* 導航欄背景 */
            --font-main: "Noto Sans TC", sans-serif;
        }
        /* 基礎設定 */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: var(--font-main);
            background-color: var(--primary-bg);
            color: var(--text-light);
            margin: 0; padding: 0; height: 100vh; overflow: hidden;
            display: flex; flex-direction: column;
        }
        /* 佈局組件 */
        header { height: 60px; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .date-selector-container { background: var(--primary-bg); padding: 10px; overflow-x: auto; display: flex; gap: 10px; border-bottom: 1px solid rgba(0,0,0,0.2); }
        .date-chip { min-width: 60px; padding: 8px; border-radius: 12px; background: rgba(255,255,255,0.1); text-align: center; cursor: pointer; font-size: 0.8rem; }
        .date-chip.active { background: var(--accent-color); color: white; transform: scale(1.05); }
        main { flex: 1; position: relative; overflow-y: auto; padding-bottom: 80px; }
        .page { display: none; padding: 20px; }
        .page.active { display: block; }
        /* 卡片與時間軸 */
        .timeline-item { position: relative; padding-left: 25px; border-left: 2px solid var(--accent-color); margin-bottom: 20px; margin-left: 10px; }
        .card { background: var(--card-bg); color: var(--text-dark); padding: 15px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.2); }
        .card-time { color: var(--accent-color); font-weight: bold; font-size: 0.8rem; }
        .card-title { margin: 5px 0; font-size: 1.1rem; }
        .tag { display: inline-block; font-size: 0.7rem; background: #ddd; padding: 2px 6px; border-radius: 4px; margin-right: 5px; }
        /* 導航 */
        nav.bottom-nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: var(--nav-bg); display: flex; justify-content: space-around; align-items: center; border-top: 1px solid rgba(255,255,255,0.1); }
        .nav-item { color: #888; text-align: center; font-size: 0.7rem; flex: 1; }
        .nav-item.active { color: var(--accent-color); }
        .nav-item i { font-size: 1.4rem; display: block; margin-bottom: 4px; }
        /* 彈窗 */
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index: 1000; align-items: flex-end; }
        .modal-content { background: white; color: var(--text-dark); width: 100%; padding: 25px; border-radius: 20px 20px 0 0; max-height: 80vh; overflow-y: auto; }
        .btn-action { background: var(--accent-color); color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; font-weight: bold; margin-top: 10px; }
       
        #map-container { height: 100%; width: 100%; min-height: 400px; }
    </style>
</head>
<body>
    <header>
        <h1 id="trip-title">My Trip</h1>
        <div onclick="location.reload()" style="cursor:pointer"><i class="fa-solid fa-rotate"></i></div>
    </header>
    <div class="date-selector-container" id="date-selector"></div>
    <main>
        <div id="page-itinerary" class="page active">
            <div id="timeline-container"></div>
        </div>
        <div id="page-map" class="page" style="height: 100%; padding: 0;">
            <div id="map-container"></div>
        </div>
        <div id="page-shopping" class="page">
            <h3><i class="fa-solid fa-basket-shopping"></i> 購物清單</h3>
            <div id="shopping-list"></div>
        </div>
    </main>
    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchPage('itinerary', event)"><i class="fa-solid fa-calendar-days"></i>行程</div>
        <div class="nav-item" onclick="switchPage('map', event)"><i class="fa-solid fa-map-location-dot"></i>地圖</div>
        <div class="nav-item" onclick="switchPage('shopping', event)"><i class="fa-solid fa-list-check"></i>清單</div>
    </nav>
    <div id="detail-modal" class="modal" onclick="if(event.target===this)closeModal()">
        <div class="modal-content">
            <h2 id="modal-title"></h2>
            <p id="modal-time" style="color:var(--accent-color); font-weight:bold;"></p>
            <p id="modal-address"></p>
            <hr>
            <div id="modal-note"></div>
            <button class="btn-action" id="btn-google-map">Google 地圖導航</button>
        </div>
    </div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        "use strict";
        /* =========================================
           2. 行程資料 (要加入新行程只需改這裡)
           ========================================= */
        const TRIP_CONFIG = {
            title: "京都祇園祭獨旅 2026",
            schedule: {
                "day1": {
                    date: "7/15",
                    label: "D1",
                    events: [
                        { time: "14:00", title: "抵達京都站", addr: "京都駅", coords: [34.9858, 135.7588], note: "利木津巴士下車點在八條口", tags: ["交通"] },
                        { time: "16:00", title: "黃櫻 Kappa Country", addr: "京都市伏見区塩屋町228", coords: [34.9305, 135.7615], note: "推薦精釀啤酒與夏季限定清酒", tags: ["美食", "必去"] }
                    ]
                },
                "day2": {
                    date: "7/16",
                    label: "D2",
                    events: [
                        { time: "20:00", title: "祇園祭 宵山", addr: "四条烏丸", coords: [35.0039, 135.7595], note: "人潮眾多，注意安全", tags: ["祭典"] }
                    ]
                }
            },
            shopping: ["阿闍梨餅", "Shiro 香水", "日本藥妝", "清酒杯"]
        };
        // --- 核心邏輯 (一般不需要改動) ---
        let currentDay = "day1";
        let map = null;
        function init() {
            document.getElementById('trip-title').innerText = TRIP_CONFIG.title;
            renderDates();
            renderTimeline("day1");
            renderShopping();
            initMap();
        }
        function renderDates() {
            const container = document.getElementById('date-selector');
            Object.keys(TRIP_CONFIG.schedule).forEach(key => {
                const day = TRIP_CONFIG.schedule[key];
                const chip = document.createElement('div');
                chip.className = `date-chip ${key === 'day1' ? 'active' : ''}`;
                chip.innerHTML = `<b>${day.label}</b><br>${day.date}`;
                chip.onclick = () => {
                    document.querySelectorAll('.date-chip').forEach(c => c.classList.remove('active'));
                    chip.classList.add('active');
                    currentDay = key;
                    renderTimeline(key);
                    updateMapMarkers(key);
                };
                container.appendChild(chip);
            });
        }
        function renderTimeline(dayKey) {
            const container = document.getElementById('timeline-container');
            container.innerHTML = `<h3>${TRIP_CONFIG.schedule[dayKey].date} 行程</h3>`;
            TRIP_CONFIG.schedule[dayKey].events.forEach(ev => {
                const item = document.createElement('div');
                item.className = 'timeline-item';
                item.innerHTML = `
                    <div class="card" onclick='openModal(${JSON.stringify(ev)})'>
                        <div class="card-time">${ev.time}</div>
                        <div class="card-title">${ev.title}</div>
                        ${ev.tags.map(t => `<span class="tag">${t}</span>`).join('')}
                    </div>
                `;
                container.appendChild(item);
            });
        }
        function renderShopping() {
            const container = document.getElementById('shopping-list');
            TRIP_CONFIG.shopping.forEach(item => {
                const div = document.createElement('div');
                div.style = "background:rgba(255,255,255,0.05); padding:15px; margin-bottom:10px; border-radius:8px;";
                div.innerHTML = `
                    <input type="checkbox"> <span style="margin-left:10px">${item}</span>
                `;
                container.appendChild(div);
            });
        }
        function switchPage(pageId, event) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active');
            event.currentTarget.classList.add('active');
            if(pageId === 'map') {
                setTimeout(() => { map.invalidateSize(); updateMapMarkers(currentDay); }, 200);
            }
        }
        function openModal(ev) {
            document.getElementById('modal-title').innerText = ev.title;
            document.getElementById('modal-time').innerText = ev.time;
            document.getElementById('modal-address').innerText = ev.addr;
            document.getElementById('modal-note').innerHTML = ev.note;
            document.getElementById('btn-google-map').onclick = () => {
                window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(ev.addr)}`);
            };
            document.getElementById('detail-modal').style.display = 'flex';
        }
        function closeModal() { document.getElementById('detail-modal').style.display = 'none'; }
        function initMap() {
            map = L.map('map-container').setView([35.00, 135.75], 13);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);
        }
        function updateMapMarkers(dayKey) {
            map.eachLayer(l => { if(l instanceof L.Marker) map.removeLayer(l); });
            const events = TRIP_CONFIG.schedule[dayKey].events;
            const pts = [];
            events.forEach(ev => {
                if(ev.coords) {
                    L.marker(ev.coords).addTo(map).bindPopup(ev.title);
                    pts.push(ev.coords);
                }
            });
            if(pts.length > 0) {
                map.fitBounds(pts, {padding: [50,50]});
            } else {
                // 處理無點情況，恢復預設視圖
                map.setView([35.00, 135.75], 13);
            }
        }
        init();
    </script>
</body>
</html>
