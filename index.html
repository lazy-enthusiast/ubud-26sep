<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ubud Slow Living (Sep 2026)</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">

<style>
:root {
--bg-body: #F9F7F2; /* æº«æš–ç±³ç™½ */
--bg-card: #FFFFFF;
--text-main: #4A403A; /* æ·±è¤ç° */
--text-sub: #8D8178;
--accent-green: #556B2F; /* æ©„æ¬–ç¶  */
--accent-orange: #D37E42; /* æ—¥è½æ©™ */
--border: #E8E4DC;
--header-bg: #F9F7F2;
--shadow: 0 4px 15px rgba(74, 64, 58, 0.05);
--sidebar-width: 320px;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body {
font-family: "Lato", sans-serif;
background-color: var(--bg-body);
color: var(--text-main);
margin: 0; padding: 0;
height: 100vh;
display: flex; flex-direction: column; overflow: hidden;
}

h1, h2, h3, .weather-temp-lg, .day-num, .phrase-big, .modal-header h2 {
font-family: "Playfair Display", serif;
}

/* --- Header --- */
header {
padding: 0 20px;
background-color: var(--header-bg);
border-bottom: 1px solid var(--border);
display: flex; justify-content: space-between; align-items: center;
height: 65px; flex-shrink: 0; position: relative; z-index: 200;
}
header h1 { margin: 0; font-size: 1.4rem; font-weight: 700; letter-spacing: 0.5px; color: var(--accent-green); }
.header-actions { display: flex; align-items: center; gap: 8px; }
.header-btn {
font-size: 1.2rem; cursor: pointer; color: var(--text-main);
border-radius: 50%; transition: background 0.2s; width: 44px; height: 44px;
display: flex; justify-content: center; align-items: center;
}
.header-btn:active { background: rgba(85, 107, 47, 0.1); }

/* --- Sidebar --- */
.sidebar-overlay {
position: fixed; top: 0; left: 0; width: 100%; height: 100%;
background: rgba(74, 64, 58, 0.4); z-index: 1000;
opacity: 0; pointer-events: none; transition: opacity 0.3s;
backdrop-filter: blur(2px);
}
.sidebar-overlay.open { opacity: 1; pointer-events: all; }

.sidebar {
position: fixed; top: 0; right: 0; width: 85%; max-width: var(--sidebar-width); height: 100%;
background: #FFFEFA; z-index: 1001;
transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
overflow-y: auto; padding: 25px 20px;
box-shadow: -5px 0 20px rgba(0,0,0,0.05);
display: flex; flex-direction: column; border-left: 4px solid var(--accent-green);
}
.sidebar.open { transform: translateX(0); }

.sidebar-section-title {
font-size: 0.75rem; color: var(--accent-orange); text-transform: uppercase; letter-spacing: 1.5px;
margin-bottom: 12px; margin-top: 30px; font-weight: 700; border-bottom: 1px solid var(--border); padding-bottom: 5px;
}

.whatsapp-box {
background: #F1F8E9; border: 1px solid #C5E1A5; color: #33691E;
padding: 15px; border-radius: 8px; margin-bottom: 10px; margin-top: 20px;
}
.wa-input {
width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #CCC; border-radius: 4px;
font-size: 0.95rem; background: #FFF; font-family: "Lato", sans-serif;
}
.wa-btn {
width: 100%; background: #25D366; color: white; border: none; padding: 12px;
border-radius: 4px; font-weight: 600; cursor: pointer;
display: flex; justify-content: center; align-items: center; gap: 8px; font-size: 0.9rem;
}

/* Tools */
.nav-launcher {
display: flex; align-items: center; gap: 15px;
background: #FFF; border: 1px solid var(--border); padding: 15px;
border-radius: 8px; margin-bottom: 10px; cursor: pointer;
transition: all 0.2s; box-shadow: var(--shadow);
}
.nav-launcher:active { background: #F5F5F5; transform: scale(0.98); }
.nav-launcher-icon { font-size: 1.3rem; color: var(--accent-green); width: 30px; text-align: center;}
.nav-launcher h3 { margin: 0; font-size: 1rem; font-weight: 600; color: var(--text-main); }
.nav-launcher p { margin: 4px 0 0 0; font-size: 0.8rem; color: var(--text-sub); }

.tool-box { background: #FFF; padding: 20px; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 10px; box-shadow: var(--shadow); }
.currency-grid { display: grid; grid-template-columns: 1fr 30px 1fr; align-items: center; gap: 5px; margin-bottom: 8px; }
.curr-group { display: flex; flex-direction: column; }
.curr-label { font-size: 0.7rem; color: var(--accent-green); font-weight: bold; margin-bottom: 4px; padding-left: 2px; letter-spacing: 1px;}
.curr-input { width: 100%; padding: 10px; border: 1px solid #DDD; border-radius: 4px; font-size: 1.1rem; text-align: center; background: #FAFAFA; font-weight: 500; font-family: "Lato", sans-serif; color: var(--text-main); }
.curr-icon { text-align: center; color: var(--text-sub); font-size: 0.9rem; margin-top: 15px;}

.rate-info-container { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; font-size: 0.75rem; color: #666;}
.rate-status { display: flex; align-items: center; gap: 5px; font-weight: 500;}
.rate-actions { display: flex; gap: 15px; }
.rate-btn-text { cursor: pointer; text-decoration: none; color: var(--accent-orange); font-weight: 600; border-bottom: 1px dotted var(--accent-orange); }

.memo-area { width: 100%; height: 100px; padding: 10px; border: 1px solid #DDD; border-radius: 4px; font-family: inherit; font-size: 0.9rem; resize: none; background: #FAFAFA; color: var(--text-main); }

/* --- Weather Module --- */
.weather-main-card {
background: linear-gradient(135deg, #556B2F, #334418);
color: #FFF; border-radius: 12px; padding: 25px;
margin: 0 20px 20px 20px; box-shadow: 0 10px 25px rgba(85, 107, 47, 0.25);
text-align: center; position: relative; overflow: hidden;
}
.weather-date { font-size: 1rem; opacity: 0.9; margin-bottom: 5px; font-weight: 500; letter-spacing: 1px; color: #EFF5E6; }
.weather-icon-lg { font-size: 4rem; margin: 15px 0; color: #FFF; filter: drop-shadow(0 2px 5px rgba(0,0,0,0.2)); }
.weather-temp-lg { font-size: 3.5rem; font-weight: 400; letter-spacing: -1px; color: #FFF; }
.weather-desc { font-size: 1.1rem; margin-bottom: 20px; font-weight: 400; color: #EFF5E6; font-style: italic; font-family: "Playfair Display", serif;}
.weather-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 0 20px; }
.weather-stat-card {
background: #FFF; border: 1px solid var(--border); padding: 15px; border-radius: 8px;
display: flex; flex-direction: column; align-items: center; justify-content: center;
box-shadow: var(--shadow);
}
.ws-icon { font-size: 1.2rem; color: var(--accent-orange); margin-bottom: 5px; }
.ws-label { font-size: 0.7rem; color: var(--text-sub); text-transform: uppercase; letter-spacing: 1px; }
.ws-value { font-size: 1.1rem; font-weight: 600; margin-top: 2px; color: var(--text-main); }

.weather-notice { text-align: center; font-size: 0.75rem; color: var(--text-main); margin-top: 20px; padding: 12px 20px; background: rgba(85, 107, 47, 0.1); border: 1px solid rgba(85, 107, 47, 0.2); border-radius: 6px; margin-left: 20px; margin-right: 20px; font-weight: 500;}

/* --- Common Pages --- */
/* DATE SELECTOR: Restored to Prototype Shape (Rounded Rectangle) */
.date-selector-container { background: var(--bg-body); padding: 15px; border-bottom: 1px solid var(--border); width: 100%; flex-shrink: 0; position: relative; z-index: 90; display: block; }
.date-selector { display: flex; gap: 10px; overflow-x: auto; scrollbar-width: none; padding-bottom: 5px; }
.date-chip {
flex: 1 0 auto; min-width: 70px; padding: 12px 0;
border-radius: 8px; /* Changed from 50px back to 8px (Prototype style) */
cursor: pointer; color: var(--text-sub);
display: flex; flex-direction: column; align-items: center; justify-content: center; background: #FFF;
border: 1px solid var(--border); transition: all 0.2s;
}
.date-chip.active {
background: var(--accent-green); color: #FFF; border-color: var(--accent-green);
box-shadow: 0 2px 8px rgba(85,107,47,0.3);
}
.day-num { font-weight: 700; font-size: 1.1rem; margin-bottom: 0px;} .day-week { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 1px; margin-top:2px;}

main { flex: 1; overflow-y: hidden; position: relative; }
.page { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow-y: auto; padding: 25px 0 100px 0; display: none; opacity: 0; transition: opacity 0.2s ease; background-color: var(--bg-body); }
.page.active { display: block; opacity: 1; z-index: 10; }
.page-header { padding: 0 20px; margin-bottom: 25px; text-align: center;}
.page-title { font-size: 2rem; font-weight: 400; margin: 0; color: var(--text-main); letter-spacing: 1px; position: relative; display: inline-block; font-style: italic;}
.page-title::after { content: ''; display: block; width: 50px; height: 3px; background: var(--accent-orange); margin: 10px auto 0 auto; opacity: 0.8;}

.timeline-container { padding: 0 20px; max-width: 800px; margin: 0 auto; }
.timeline-item { position: relative; padding-left: 35px; padding-bottom: 35px; border-left: 1px solid #D6CEC5; }
.timeline-item:last-child { border-left: 1px solid transparent; }
.timeline-item::before {
content: ''; position: absolute; left: -5px; top: 25px; width: 9px; height: 9px;
background: var(--bg-body); border: 2px solid var(--accent-green); border-radius: 50%;
box-shadow: 0 0 0 4px var(--bg-body); z-index: 2;
}
.card {
background-color: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 25px;
box-shadow: var(--shadow); cursor: pointer; position: relative; transition: transform 0.2s; border-left: 3px solid var(--accent-green);
}
.card:active { transform: scale(0.98); }
.card-time { font-size: 0.8rem; color: var(--accent-green); font-weight: 700; margin-bottom: 8px; display: block; letter-spacing: 1px; text-transform: uppercase;}
.card-title { font-size: 1.25rem; font-weight: 600; margin: 0 0 12px 0; padding-right: 30px; color: var(--text-main); font-family: "Playfair Display", serif;}
.tags { display: flex; gap: 6px; flex-wrap: wrap; }
.card-tag { font-size: 0.65rem; background: rgba(211, 126, 66, 0.1); padding: 5px 12px; border-radius: 20px; color: var(--accent-orange); border: 1px solid rgba(211, 126, 66, 0.2); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;}
.card-nav-btn {
position: absolute; top: 25px; right: 20px; width: 35px; height: 35px; border-radius: 50%;
background: #F9F9F9; color: var(--text-main); display: flex; justify-content: center; align-items: center;
font-size: 1rem; transition: all 0.2s; z-index: 5; border: 1px solid var(--border); box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}
.card-nav-btn:hover { background: var(--accent-green); color: #FFF; border-color: var(--accent-green); }

.filter-bar-container { padding: 0 20px 15px 20px; position: sticky; top: 0; z-index: 50; background: var(--bg-body); overflow-x: auto; white-space: nowrap; scrollbar-width: none; border-bottom: 1px solid rgba(74, 64, 58, 0.05); }
.filter-chip {
display: inline-block; padding: 8px 20px; margin-right: 8px; background: #FFF; border: 1px solid var(--border);
border-radius: 20px; font-size: 0.85rem; color: var(--text-sub); cursor: pointer; transition: all 0.2s;
}
.filter-chip.active { background: var(--text-main); color: #FFF; border-color: var(--text-main); }
.inspiration-grid { padding: 0 20px; display: grid; gap: 15px; }
.inspire-card { background: #FFF; border: 1px solid var(--border); border-radius: 8px; padding: 25px; color: #444; position: relative; display: block; box-shadow: var(--shadow); }
.inspire-card.hidden { display: none; }
.inspire-badge { background: var(--accent-green); color: #FFF; padding: 4px 12px; border-radius: 4px; font-size: 0.65rem; font-weight: bold; position: absolute; top: -10px; left: 20px; letter-spacing: 1px; text-transform: uppercase;}
.shopping-list { padding: 0 20px; }
.shop-item { background: #FFF; padding: 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 15px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
.shop-item input[type="checkbox"] { width: 20px; height: 20px; accent-color: var(--accent-green); cursor: pointer; border-radius: 50%;}
.shop-item label { font-size: 1rem; color: var(--text-main); cursor: pointer; flex: 1; font-weight: 500;}

.info-card { background: #FFF; padding: 30px; border-radius: 8px; margin: 0 20px 20px 20px; border: 1px solid var(--border); box-shadow: var(--shadow); position: relative; overflow: hidden;}
.info-card::before { content:''; position: absolute; top:0; left:0; width:5px; height:100%; background: var(--accent-orange); }
.info-row { display: flex; gap: 18px; margin-bottom: 18px; align-items: flex-start; font-size: 0.95rem; color: #333; }
.info-icon { color: var(--accent-green); width: 22px; text-align: center; margin-top: 2px; font-size: 1.1rem;}
.info-label { display: block; font-size: 0.7rem; color: var(--accent-orange); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 4px; font-weight: 600;}
.info-value { font-weight: 500; color: var(--text-main); font-family: "Playfair Display", serif; font-size: 1.1rem;}
.contact-container { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; margin-top: 8px; }
.btn-icon-sm { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; text-decoration: none; font-size: 1.1rem; cursor: pointer; transition: transform 0.1s; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
.btn-icon-sm:active { transform: scale(0.9); }
.btn-call { background: #FFF; color: var(--text-main); border: 1px solid var(--border); }
.btn-wa { background: #25D366; color: white; border: 1px solid #20bd5a; }

.phrase-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 0 20px; }
.phrase-card {
background: #FFF; border: 1px solid var(--border); padding: 25px 15px; border-radius: 8px; text-align: center;
cursor: pointer; transition: all 0.2s; box-shadow: var(--shadow); aspect-ratio: 1.2;
display: flex; flex-direction: column; justify-content: center; align-items: center;
}
.phrase-card:active { transform: scale(0.96); background: #FAF6F0; border-color: var(--accent-orange); }
.phrase-jp { font-weight: 600; font-size: 0.95rem; margin-bottom: 10px; color: var(--text-main); font-family: "Lato", sans-serif; line-height: 1.4;}
.phrase-zh { font-size: 0.8rem; color: var(--accent-green); text-transform: uppercase; letter-spacing: 1px;}
.phrase-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(249, 247, 242, 0.98); z-index: 5000; display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
.phrase-overlay.active { opacity: 1; pointer-events: all; }
.phrase-content { text-align: center; width: 85%; }
.phrase-big { font-size: 2.2rem; font-weight: 700; color: var(--text-main); line-height: 1.4; margin-bottom: 25px; word-break: break-word; font-style: italic;}
.phrase-sub { font-size: 1rem; color: var(--accent-green); margin-bottom: 40px; font-weight: 500; text-transform: uppercase; letter-spacing: 2px;}
.close-phrase {
position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%); border: 1px solid var(--text-main);
padding: 12px 35px; border-radius: 50px; color: var(--text-main); cursor: pointer; background: transparent;
font-weight: 600; letter-spacing: 1px; transition: all 0.2s;
}
.close-phrase:active { background: var(--text-main); color: #FFF; }

.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(74, 64, 58, 0.5); z-index: 3000; justify-content: center; align-items: end; backdrop-filter: blur(2px); cursor: pointer; }
.modal.open { display: flex; }
.modal-content {
background: #FFF; color: #000; width: 100%; max-width: 600px; max-height: 90vh; border-radius: 12px 12px 0 0;
padding: 30px; overflow-y: auto; animation: slideUp 0.3s ease; cursor: default; display: flex; flex-direction: column;
}
@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
#modal-mini-map { width: 100%; height: 220px; background: #EEE; border-radius: 8px; margin-bottom: 25px; border: 1px solid var(--border); flex-shrink: 0;}
.modal-info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
.modal-label { font-size: 0.7rem; color: var(--accent-orange); text-transform: uppercase; letter-spacing: 1.5px; display: block; margin-bottom: 5px; font-weight: 600;}
.modal-value { font-size: 1rem; font-weight: 500; color: var(--text-main); font-family: "Lato", sans-serif;}
.modal-note-box { background: #F9F7F2; padding: 25px; border-radius: 8px; border-left: 4px solid var(--accent-green); margin: 20px 0; }
.modal-note-content { font-size: 0.95rem; line-height: 1.8; white-space: pre-line; color: #555; font-family: "Lato", sans-serif;}
.modal-actions { margin-top: 15px; display: flex; flex-direction: column; gap: 12px;}
.btn-action { width: 100%; padding: 16px; border-radius: 6px; border: none; font-weight: 600; cursor: pointer; font-size: 1rem; text-align: center; transition: opacity 0.2s; letter-spacing: 0.5px;}
.btn-black { background: var(--text-main); color: #FFF; }
.btn-black:active { opacity: 0.9; }
.nav-link { font-size:0.85rem; color:var(--text-main); text-decoration:none; margin-left:8px; background:var(--bg-body); padding:4px 10px; border-radius:4px; display:inline-block; border:1px solid var(--border);}

nav.bottom-nav { position: fixed; bottom: 0; width: 100%; background-color: #FFF; display: flex; justify-content: space-around; padding: 15px 0 30px 0; border-top: 1px solid var(--border); z-index: 100; box-shadow: 0 -5px 15px rgba(0,0,0,0.03); }
.nav-item { color: #CCC; text-align: center; font-size: 0.7rem; cursor: pointer; width: 25%; transition: color 0.2s; }
.nav-item i { display: block; font-size: 1.3rem; margin-bottom: 6px; }
.nav-item.active { color: var(--accent-green); }
</style>
</head>
<body>

<header>
<h1>Ubud <span style="font-weight:400; opacity:0.8; font-size:1rem; font-family:'Playfair Display'; font-style:italic;">Slow Living</span></h1>
<div class="header-actions">
<div class="header-btn" onclick="openTranslate()"><i class="fa-solid fa-language"></i></div>
<div class="header-btn" onclick="toggleSidebar()"><i class="fa-solid fa-bars"></i></div>
</div>
</header>

<div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>
<div class="sidebar" id="sidebar">
<div class="whatsapp-box">
<div style="font-weight:bold; margin-bottom:5px; color:#33691E;"><i class="fa-brands fa-whatsapp"></i> å®‰å…¨ Check-in</div>
<input type="tel" id="wa-phone" class="wa-input" placeholder="å°æ–¹é›»è©± (å¦‚ 85291234567)">
<button class="wa-btn" id="wa-btn" onclick="sendWhatsApp()"><i class="fa-solid fa-paper-plane"></i> ç™¼é€ä½ç½®</button>
</div>

<div class="sidebar-section-title">Navigation</div>
<div class="nav-launcher" onclick="navigateTo('phrases')">
<div class="nav-launcher-icon"><i class="fa-solid fa-comments"></i></div>
<div class="nav-launcher-text"><h3>æ‰‹æŒ‡å°è©±å¡</h3><p>Bahasa Indonesia (å°å°¼èª)</p></div>
</div>
<div class="nav-launcher" onclick="navigateTo('info')">
<div class="nav-launcher-icon"><i class="fa-solid fa-suitcase"></i></div>
<div class="nav-launcher-text"><h3>æ—…ç¨‹è³‡è¨Š</h3><p>Tegal Sari ä½å®¿ã€ç·Šæ€¥é›»è©±</p></div>
</div>

<div class="sidebar-section-title">Utilities</div>
<div class="tool-box">
<div style="font-weight:bold; margin-bottom:15px; color:var(--text-main);"><i class="fa-solid fa-coins"></i> åŒ¯ç‡è¨ˆç®— (IDR â‡„ HKD)</div>
<div class="currency-grid">
<div class="curr-group"><span class="curr-label">IDR (å°å°¼ç›¾)</span><input type="number" id="curr-idr" class="curr-input" placeholder="0" oninput="convertCurrency()"></div>
<div class="curr-icon"><i class="fa-solid fa-right-left"></i></div>
<div class="curr-group"><span class="curr-label">HKD (æ¸¯å¹£)</span><input type="number" id="curr-hkd" class="curr-input" placeholder="0" readonly style="background:var(--bg-body);"></div>
</div>
<div class="rate-info-container">
<div id="rate-status" class="rate-status"><i class="fa-solid fa-circle-notch fa-spin"></i> è¼‰å…¥ä¸­...</div>
<div class="rate-actions">
<span class="rate-btn-text" onclick="fetchRates(true)">åˆ·æ–°</span>
<span class="rate-btn-text" onclick="editRate()">æ‰‹å‹•</span>
</div>
</div>
</div>
<div class="tool-box">
<div style="font-weight:bold; margin-bottom:10px; color:var(--text-main);"><i class="fa-solid fa-pen"></i> æ…¢æ´»éš¨æ‰‹è¨˜</div>
<textarea id="quick-memo" class="memo-area" placeholder="é¦™æ°´é…æ–¹ã€SPA æ„Ÿå—ã€æé†’äº‹é …..." oninput="saveMemo()"></textarea>
</div>
</div>

<div id="phrase-overlay" class="phrase-overlay" onclick="closePhrase()">
<div class="phrase-content"><div id="overlay-jp" class="phrase-big"></div><div id="overlay-zh" class="phrase-sub"></div></div>
<div class="close-phrase">Tutup (é—œé–‰)</div>
</div>

<div class="date-selector-container">
<div class="date-selector" id="date-selector"></div>
</div>

<main>
<div id="page-itinerary" class="page active">
<div class="timeline-container" id="timeline-container"></div>
</div>
<div id="page-inspiration" class="page">
<div class="filter-bar-container">
<span class="filter-chip active" onclick="filterInspiration('all', this)">å…¨éƒ¨</span>
<span class="filter-chip" onclick="filterInspiration('SPA', this)">ğŸŒ¿ Spa/æŒ‰æ‘©</span>
<span class="filter-chip" onclick="filterInspiration('FOOD', this)">ğŸ½ï¸ ç¾é£Ÿ</span>
<span class="filter-chip" onclick="filterInspiration('SHOP', this)">ğŸ›ï¸ è³¼ç‰©</span>
</div>
<div id="inspiration-container" class="inspiration-grid"></div>
</div>
<div id="page-shopping" class="page">
<div class="page-header"><h2 class="page-title">è³¼ç‰©æ¸…å–®</h2></div>
<div id="shopping-container" class="shopping-list"></div>
</div>

<div id="page-weather" class="page">
<div id="weather-content">
<div style="text-align:center; padding:50px; opacity:0.5;"><i class="fa-solid fa-spinner fa-spin fa-2x"></i><p>è¼‰å…¥çƒå¸ƒå¤©æ°£ä¸­...</p></div>
</div>
<div class="weather-notice" id="weather-notice"></div>
</div>

<div id="page-phrases" class="page">
<div class="page-header"><h2 class="page-title">Bahasa Indonesia</h2></div>
<div class="sidebar-section-title" style="margin-left:20px; border:none; margin-top:0;">å¸æ©Ÿèˆ‡äº¤é€š</div>
<div class="phrase-grid">
<div class="phrase-card" onclick="showPhrase('Pak Sopir, tolong antar saya ke sini.', 'å¸æ©Ÿå…ˆç”Ÿï¼Œè«‹è¼‰æˆ‘åˆ°é€™è£¡')"><div class="phrase-jp">Pak Sopir, tolong antar saya ke sini.</div><div class="phrase-zh">è¼‰æˆ‘åˆ°é€™è£¡</div></div>
<div class="phrase-card" onclick="showPhrase('Tolong nyalakan AC.', 'è«‹é–‹å†·æ°£')"><div class="phrase-jp">Tolong nyalakan AC.</div><div class="phrase-zh">è«‹é–‹å†·æ°£</div></div>
<div class="phrase-card" onclick="showPhrase('Tolong pelan-pelan saja.', 'è«‹é–‹æ…¢ä¸€é»')"><div class="phrase-jp">Tolong pelan-pelan saja.</div><div class="phrase-zh">é–‹æ…¢ä¸€é»</div></div>
<div class="phrase-card" onclick="showPhrase('Tolong tunggu sebentar.', 'è«‹ç¨ç­‰ä¸€ä¸‹')"><div class="phrase-jp">Tolong tunggu sebentar.</div><div class="phrase-zh">è«‹ç¨ç­‰ä¸€ä¸‹</div></div>
</div>

<div class="sidebar-section-title" style="margin-left:20px; border:none;">é¤å»³é£²é£Ÿ</div>
<div class="phrase-grid">
<div class="phrase-card" onclick="showPhrase('Minta bon.', 'éº»ç…©çµå¸³ (Minta bon)')"><div class="phrase-jp">Minta bon.</div><div class="phrase-zh">çµå¸³</div></div>
<div class="phrase-card" onclick="showPhrase('Tanpa gula.', 'ä¸è¦ç³– (Tanpa gula)')"><div class="phrase-jp">Tanpa gula.</div><div class="phrase-zh">ä¸è¦ç³–</div></div>
<div class="phrase-card" onclick="showPhrase('Tidak pedas.', 'ä¸è¦è¾£ (Tidak pedas)')"><div class="phrase-jp">Tidak pedas.</div><div class="phrase-zh">ä¸è¦è¾£</div></div>
<div class="phrase-card" onclick="showPhrase('Tanpa MSG.', 'ä¸è¦å‘³ç²¾')"><div class="phrase-jp">Tanpa MSG.</div><div class="phrase-zh">ä¸è¦å‘³ç²¾</div></div>
</div>

<div class="sidebar-section-title" style="margin-left:20px; border:none;">è³¼ç‰©</div>
<div class="phrase-grid">
<div class="phrase-card" onclick="showPhrase('Berapa harganya?', 'é€™å€‹å¤šå°‘éŒ¢ï¼Ÿ')"><div class="phrase-jp">Berapa harganya?</div><div class="phrase-zh">å¤šå°‘éŒ¢ï¼Ÿ</div></div>
<div class="phrase-card" onclick="showPhrase('Bisa kurang?', 'å¯ä»¥ä¾¿å®œä¸€é»å—ï¼Ÿ (æ®ºåƒ¹)')"><div class="phrase-jp">Bisa kurang?</div><div class="phrase-zh">å¯ä»¥ä¾¿å®œå—ï¼Ÿ</div></div>
<div class="phrase-card" onclick="showPhrase('Terima kasih.', 'è¬è¬')"><div class="phrase-jp">Terima kasih.</div><div class="phrase-zh">è¬è¬</div></div>
<div class="phrase-card" onclick="showPhrase('Permisi.', 'ä¸å¥½æ„æ€/å€Ÿé')"><div class="phrase-jp">Permisi.</div><div class="phrase-zh">å€Ÿé</div></div>
</div>
</div>

<div id="page-info" class="page">
<div class="page-header"><h2 class="page-title">æ—…ç¨‹è³‡è¨Š</h2></div>
<div class="info-card">
<div style="font-weight:bold; margin-bottom:15px; border-bottom:1px solid var(--border); padding-bottom:10px; color:var(--text-main);">ä½å®¿è³‡è¨Š</div>
<div class="info-row"><div class="info-icon"><i class="fa-solid fa-hotel"></i></div><div><span class="info-label">é£¯åº—</span><span class="info-value">Tegal Sari Accommodation</span></div></div>
<div class="info-row"><div class="info-icon"><i class="fa-solid fa-bed"></i></div><div><span class="info-label">æˆ¿å‹</span><span class="info-value">Super Deluxe Wooden (Upper)</span></div></div>
<div class="info-row">
<div class="info-icon"><i class="fa-solid fa-location-dot"></i></div>
<div><span class="info-label">åœ°å€</span><span class="info-value">Jl. Hanoman, Padang Tegal</span><a href="javascript:void(0)" onclick="openMapQuery('Tegal Sari Accommodation Ubud')" class="nav-link"><i class="fa-solid fa-location-arrow"></i> å°èˆª</a></div>
</div>
</div>
<div class="info-card">
<div style="font-weight:bold; margin-bottom:15px; border-bottom:1px solid var(--border); padding-bottom:10px; color:var(--text-main);">ç·Šæ€¥è¯çµ¡ (Bali)</div>
<div class="info-row"><div class="info-icon"><i class="fa-solid fa-shield-halved"></i></div><div style="width:100%; display:flex; justify-content:space-between; align-items:center;"><div><span class="info-label">è­¦å¯Ÿå±€</span><span class="info-value">110</span></div><a href="javascript:void(0)" onclick="callNumber('110')" class="btn-icon-sm btn-call"><i class="fa-solid fa-phone"></i></a></div></div>
<div class="info-row"><div class="info-icon"><i class="fa-solid fa-truck-medical"></i></div><div style="width:100%; display:flex; justify-content:space-between; align-items:center;"><div><span class="info-label">æ•‘è­·è»Š</span><span class="info-value">119</span></div><a href="javascript:void(0)" onclick="callNumber('119')" class="btn-icon-sm btn-call"><i class="fa-solid fa-phone"></i></a></div></div>
<div class="info-row"><div class="info-icon"><i class="fa-solid fa-plane"></i></div><div style="width:100%; display:flex; justify-content:space-between; align-items:center;"><div><span class="info-label">è¿”ç¨‹èˆªç­</span><span class="info-value">CX784 (16:10)</span></div></div></div>
</div>
</div>
</main>

<nav class="bottom-nav">
<div class="nav-item active" onclick="switchMainPage('itinerary', this)"><i class="fa-regular fa-calendar"></i><span>è¡Œç¨‹</span></div>
<div class="nav-item" onclick="switchMainPage('inspiration', this)"><i class="fa-regular fa-lightbulb"></i><span>éˆæ„Ÿ</span></div>
<div class="nav-item" onclick="switchMainPage('shopping', this)"><i class="fa-solid fa-bag-shopping"></i><span>æ¸…å–®</span></div>
<div class="nav-item" onclick="switchMainPage('weather', this)"><i class="fa-solid fa-cloud"></i><span>å¤©æ°£</span></div>
</nav>

<div id="detail-modal" class="modal">
<div class="modal-content">
<div style="position:absolute; top:20px; right:20px; font-size:1.5rem; cursor:pointer;" onclick="closeModal()">Ã—</div>
<div id="modal-mini-map"></div>
<div class="modal-header">
<span class="modal-label" id="modal-type">Type</span>
<h2 id="modal-title" style="margin:0; font-family:'Playfair Display', serif; font-size:1.6rem; color:var(--text-main);">Title</h2>
</div>
<div class="modal-info-grid">
<div><span class="modal-label">æ™‚é–“</span><span class="modal-value" id="modal-time"></span></div>
<div><span class="modal-label">é ç®—/åƒ¹æ ¼</span><span class="modal-value" id="modal-price"></span></div>
<div><span class="modal-label">ç‡Ÿæ¥­æ™‚é–“</span><span class="modal-value" id="modal-open-hours"></span></div>
<div><span class="modal-label">åœ°å€</span><span class="modal-value" id="modal-address-short" style="font-size:0.85rem;"></span><a href="javascript:void(0)" id="modal-nav-link" class="nav-link"><i class="fa-solid fa-location-arrow"></i> å°èˆª</a></div>
</div>
<div class="modal-label">ç­†è¨˜èˆ‡æ”»ç•¥</div>
<div class="modal-note-box"><div id="modal-note" class="modal-note-content"></div></div>
<div class="modal-actions" id="modal-actions"></div>
</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// --- UBUD SCHEDULE DATA (Sep 25 - Sep 30) ---
const scheduleData = {
"day1": {
"date": "2026-09-25", "display": "Sep 25", "weekday": "é€±äº”",
"events": [
{ time: "15:00", title: "æŠµé”æ©Ÿå ´ (DPS)", type: "äº¤é€š", price: "å«æ¥é€", open_hours: "-", address: "Jalan Raya Gusti Ngurah Rai, Tuban", coords: [-8.7481, 115.1670], note: "1. è¾¦ç†å…¥å¢ƒï¼Œæ‰¾èˆ‰è‘— 'Tegal Sari' ç‰Œå­çš„å¸æ©Ÿã€‚\n2. è»Šç¨‹ç´„ 1.5-2 å°æ™‚ã€‚", tags: ["æŠµé”"] },
{ time: "17:30", title: "Tegal Sari (Check-in)", type: "ä½å®¿", price: "$40-50", open_hours: "24H", address: "Jl. Hanoman, Padang Tegal", coords: [-8.5196, 115.2632], note: "é‡é»ï¼šç¢ºèªæˆ¿é–“ç‚ºã€ŒäºŒæ¨“ (Upper Floor)ã€ä¸”é¢å‘ç¨»ç”°ã€‚", tags: ["ä½å®¿"] },
{ time: "18:00", title: "Coco Supermarket", type: "è³¼ç‰©", price: "IDR 200k", open_hours: "07-23", address: "Jl. Raya Pengosekan", coords: [-8.5179, 115.2635], note: "é£¯åº—å‡ºé–€å³è½‰å³é”ã€‚æ¡è²·ç´…é…’ã€æ°´ã€é˜²èšŠæ¶²ã€‚", tags: ["æ¡è²·"] },
{ time: "19:00", title: "Pison Ubud", type: "æ™šé¤", price: "HKD 100", open_hours: "07-23", address: "Jl. Hanoman No. 10X", coords: [-8.5178, 115.2637], note: "ç¨»ç”°æ™¯è§€å’–å•¡å»³ï¼Œé€±äº”æ™šæ°£æ°›ä½³ä¸”å®‰å…¨ã€‚æ¨è–¦ç¾©å¤§åˆ©éºµé…ç´…é…’ã€‚", tags: ["ç¾é£Ÿ"] },
{ time: "20:30", title: "é™½å°ä¼‘æ¯", type: "ä¼‘æ¯", price: "-", open_hours: "-", address: "Tegal Sari", coords: [-8.5196, 115.2632], note: "åœ¨é™½å°äº«å—å¯§éœï¼Œæ³¡æ¯ç†±èŒ¶ï¼Œåšè¼•ä¼¸å±•æ¶ˆé™¤ç–²å‹ã€‚", tags: ["æ”¾é¬†"] }
],
"inspiration": [{title:"é™½å°æ™‚å…‰", tag:"SPA", note:"åœ¨é£¯åº—é™½å°åšä¼¸å±•æˆ–æ³¡èŒ¶"}],
"shopping": ["ç´…é…’", "èµ·å¸", "æ°´æœ", "å„ªæ ¼", "é˜²èšŠå™´éœ§"]
},
"day2": {
"date": "2026-09-26", "display": "Sep 26", "weekday": "é€±å…­",
"events": [
{ time: "09:30", title: "åŒ…è»Šå‡ºç™¼ (Private Car)", type: "äº¤é€š", price: "-", open_hours: "-", address: "Tegal Sari Lobby", coords: [-8.5196, 115.2632], note: "ç¢ºèªå¸æ©Ÿè­‰ä»¶ï¼Œå‘ŠçŸ¥è·¯ç·šã€‚å¸¶èƒŒåŒ…è£æ°´å’Œæ›¿æ›è¡£ç‰©ã€‚", tags: ["ç§»å‹•"] },
{ time: "09:45", title: "BMC Money Changer", type: "æ›åŒ¯", price: "-", open_hours: "08-20", address: "Jl. Raya Pengosekan No.108", coords: [-8.5200, 115.2635], note: "ç”¨æ¸¯å¹£æ› IDRï¼Œå‹™å¿…ç•¶é¢é»æ¸…ä¸¦ç´¢å–æ”¶æ“šã€‚", tags: ["æ›åŒ¯"] },
{ time: "10:30", title: "è–æ³‰å»Ÿ (æ·¨åŒ–å„€å¼)", type: "é«”é©—", price: "IDR 50k", open_hours: "08-18", address: "Sebatu, Tegallalang", coords: [-8.3844, 115.2930], note: "Melukat æ°´æ·¨åŒ–å„€å¼ï¼Œéœ€æ›æ²™é¾ã€‚æ³‰æ°´å¾ˆæ¶¼ï¼Œè¨˜å¾—å¸¶æ¯›å·¾ã€‚", tags: ["æ–‡åŒ–"] },
{ time: "12:00", title: "æ™¯è§€é¤å»³åˆé¤", type: "ç¾é£Ÿ", price: "-", open_hours: "-", address: "Kintamani / Tegalalang", coords: [-8.4300, 115.2800], note: "è«‹å¸æ©Ÿæ¨è–¦ã€‚é¸æ“‡æœ‰ç¨»ç”°æˆ–å±±æ™¯ï¼Œå–®èº«å¥³æ€§å‹å–„ç’°å¢ƒã€‚", tags: ["åˆé¤"] },
{ time: "13:30", title: "Svasensa Perfume Workshop", type: "é«”é©—", price: "IDR 459k", open_hours: "09-18", address: "Toya Ubud Eco Park", coords: [-8.4390, 115.2810], note: "Signature Workshop (åˆéš 90åˆ†é˜)ã€‚", tags: ["é¦™æ°›"] },
{ time: "16:00", title: "é¢å…·èˆ‡æœ¨å¶åšç‰©é¤¨", type: "æ™¯é»", price: "æç»åˆ¶", open_hours: "08-16", address: "Jalan Tegal Bingin, Mas", coords: [-8.5342, 115.2792], note: "æ¬£è³åƒä»¶é¢å…·ã€‚å®¤å…§è¼ƒæš—ï¼Œå¯ç”¨æ‰‹æ©Ÿæ‰‹é›»ç­’ã€‚", tags: ["æ–‡åŒ–"] },
{ time: "18:30", title: "The Yoga Barn (Garden Kafe)", type: "æ™šé¤", price: "IDR 100k", open_hours: "07-21", address: "Jl. Hanoman", coords: [-8.5193, 115.2653], note: "æœ‰æ©Ÿå¥åº·æ–™ç† (Smoothie Bowl)ï¼Œç’°å¢ƒæ”¾é¬†ã€‚", tags: ["ç¾é£Ÿ"] }
],
"inspiration": [],
"shopping": ["é¢å…·åšç‰©é¤¨ç´€å¿µå“"]
},
"day3": {
"date": "2026-09-27", "display": "Sep 27", "weekday": "é€±æ—¥",
"events": [
{ time: "09:30", title: "ARMA Museum", type: "æ™¯é»", price: "IDR 150k", open_hours: "09-18", address: "Jl. Raya Pengosekan", coords: [-8.5229, 115.2632], note: "çš‡å®¶èŠ±åœ’èˆ¬çš„åšç‰©é¤¨ï¼Œé ç•™ 2 å°æ™‚æ•£æ­¥ã€‚", tags: ["æ–‡åŒ–"] },
{ time: "11:30", title: "Andong å¤è‘£è¡—", type: "è³¼ç‰©", price: "-", open_hours: "10-17", address: "Jalan Raya Andong", coords: [-8.5077, 115.2710], note: "ç­–ç•¥ï¼šæ­ Grab åˆ°ä¸Šæ¸¸ï¼Œå¾€ä¸‹å¡èµ°å›å¸‚å€ã€‚æœ¨é›•å¯è­°åƒ¹ã€‚", tags: ["è³¼ç‰©"] },
{ time: "14:00", title: "Bebek Bengil (é«’é´¨é£¯)", type: "åˆé¤", price: "RM 63", open_hours: "11-22", address: "Jl. Hanoman", coords: [-8.5178, 115.2637], note: "å‰µå§‹è€åº—ã€‚å»ºè­°é¸åœ¨æ¶¼äº­ (Bale) ç”¨é¤ï¼Œå¯çœ‹ç¨»ç”°ã€‚", tags: ["ç¾é£Ÿ"] },
{ time: "16:00", title: "Jaens Spa", type: "é«”é©—", price: "IDR 300k+", open_hours: "09-21", address: "Jl. Raya Pengosekan", coords: [-8.5170, 115.2630], note: "æ¨è–¦ Balinese Massage (60-90åˆ†é˜)ã€‚", tags: ["SPA"] },
{ time: "18:30", title: "Kebun Bistro", type: "æ™šé¤", price: "IDR 200k", open_hours: "11-23", address: "Jl. Hanoman No.44", coords: [-8.5136, 115.2642], note: "å—æ³•é„‰æ‘é¢¨å°é…’é¤¨ã€‚ç´…ç™½é…’å–®è±å¯Œï¼Œé©åˆå–®èº«å¥³æ€§ç¨é…Œã€‚", tags: ["ç¾é£Ÿ"] }
],
"inspiration": [],
"shopping": ["æœ¨é›•", "éŠ€å™¨"]
},
"day4": {
"date": "2026-09-28", "display": "Sep 28", "weekday": "é€±ä¸€",
"events": [
{ time: "08:00", title: "Ubud Morning Market", type: "æ™¯é»", price: "IDR 50k", open_hours: "04-09", address: "Jl. Raya Ubud", coords: [-8.5077, 115.2710], note: "æ„Ÿå—ç•¶åœ°ç”Ÿæ´»ï¼Œè²·æ–°é®®èŠ’æœ/å±±ç«¹ã€‚äººæ½®å¤šæ³¨æ„éŒ¢åŒ…ã€‚", tags: ["æ–‡åŒ–"] },
{ time: "09:30", title: "Blue Stone Botanicals", type: "è³¼ç‰©", price: "IDR 150k", open_hours: "09-20", address: "Jl. Dewi Sita", coords: [-8.5193, 115.2653], note: "è³¼è²·é›¨æ—èˆ‡å³¶å¶¼éˆæ„Ÿçš„å¤©ç„¶ç²¾æ²¹ã€‚", tags: ["é¦™æ°›"] },
{ time: "10:15", title: "Bohe Bali Perfumery", type: "è³¼ç‰©", price: "$7-17", open_hours: "10-18", address: "Jl. Monkey Forest", coords: [-8.5124, 115.2609], note: "ç²¾ç·»åŒ…è£çš„é¦™æ°´åº—ã€‚", tags: ["é¦™æ°›"] },
{ time: "11:00", title: "OILAND", type: "è³¼ç‰©", price: "IDR 150k", open_hours: "10-18", address: "Jl. Hanoman No.30a", coords: [-8.5196, 115.2632], note: "å¤©ç„¶èº«é«”è­·è†šæ²¹ã€‚", tags: ["é¦™æ°›"] },
{ time: "11:30", title: "Taco Casa", type: "åˆé¤", price: "IDR 55k", open_hours: "11-22", address: "Jl. Pengosekan", coords: [-8.5310, 115.2640], note: "å¢¨è¥¿å“¥æ–™ç†ï¼Œå£å‘³æ¸…çˆ½ï¼Œå¿«é€Ÿç”¨é¤ã€‚", tags: ["ç¾é£Ÿ"] },
{ time: "14:00", title: "Zen Bali Spa", type: "é«”é©—", price: "IDR 150k", open_hours: "10-20", address: "Jl. Hanoman", coords: [-8.5130, 115.2630], note: "é£¯åº—é™„è¿‘çš„å„ªè³ªæŒ‰æ‘©ï¼Œå¯åŠ é¸ç†±çŸ³ç™‚æ³•ã€‚", tags: ["SPA"] },
{ time: "18:30", title: "Laminak", type: "æ™šé¤", price: "IDR 250k", open_hours: "12-23", address: "Jl. Raya Pengosekan", coords: [-8.5170, 115.2630], note: "å·´æ–¯å…‹æ–™ç†ã€‚æ¨è–¦ Paellaã€‚æœ‰ç¾å ´éŸ³æ¨‚ï¼Œæ°£æ°›æº«é¦¨ã€‚", tags: ["ç¾é£Ÿ"] }
],
"inspiration": [],
"shopping": ["ç†±å¸¶æ°´æœ", "å¤©ç„¶ç²¾æ²¹", "é¦™æ°´"]
},
"day5": {
"date": "2026-09-29", "display": "Sep 29", "weekday": "é€±äºŒ",
"events": [
{ time: "11:00", title: "Coco Supermarket", type: "è³¼ç‰©", price: "-", open_hours: "07-23", address: "Jl. Raya Pengosekan", coords: [-8.5179, 115.2635], note: "æœ€å¾Œè£œè²¨ï¼Œè²·å·§å…‹åŠ›æˆ–ä¼´æ‰‹ç¦®ã€‚", tags: ["æ¡è²·"] },
{ time: "12:00", title: "åŒ…è»Šå¸æ©Ÿæ¥é€", type: "äº¤é€š", price: "-", open_hours: "-", address: "Tegal Sari Lobby", coords: [-8.5196, 115.2632], note: "åŒ…è»Šæ™‚æ•¸ç´„ 7-8 å°æ™‚ã€‚", tags: ["ç§»å‹•"] },
{ time: "12:30", title: "Svasensa Perfume (é€²éš)", type: "é«”é©—", price: "IDR 600k", open_hours: "éœ€é ç´„", address: "Toya Ubud Eco Park", coords: [-8.4390, 115.2810], note: "Advanced Session (3.5å°æ™‚)ã€‚æ·±å…¥é¦™æ°›å±¤æ¬¡ã€‚", tags: ["é¦™æ°›"] },
{ time: "17:30", title: "Sayan House", type: "æ™šé¤", price: "HKD 330", open_hours: "12-23", address: "Jl. Raya Sayan No.70", coords: [-8.5002, 115.2382], note: "é‡é»ï¼šåœ¨æ‡¸å´–é‚Šçœ‹æ—¥è½(18:10)ã€‚æ—¥å¼æ‹‰ä¸èåˆæ–™ç†ã€‚", tags: ["ç¾é£Ÿ"] }
],
"inspiration": [],
"shopping": ["å·§å…‹åŠ›", "ä¼´æ‰‹ç¦®"]
},
"day6": {
"date": "2026-09-30", "display": "Sep 30", "weekday": "é€±ä¸‰",
"events": [
{ time: "11:00", title: "é€€æˆ¿ï¼Œå‰å¾€æ©Ÿå ´", type: "äº¤é€š", price: "-", open_hours: "-", address: "Tegal Sari Lobby", coords: [-8.5196, 115.2632], note: "æ­ä¹˜é£¯åº—å°ˆè»Šã€‚ç¢ºèªå¸³å–®ã€‚è»Šç¨‹é æŠ“ 2 å°æ™‚ã€‚", tags: ["å›ç¨‹"] },
{ time: "13:30", title: "æ©Ÿå ´å…ç¨…åº— (DPS)", type: "è³¼ç‰©", price: "-", open_hours: "-", address: "Ngurah Rai Airport", coords: [-8.7481, 115.1670], note: "æ¶ˆè€—å‰©é¤˜å°å°¼ç›¾ã€‚", tags: ["è³¼ç‰©"] },
{ time: "16:10", title: "èˆªç­ CX784 è¿”æ¸¯", type: "äº¤é€š", price: "-", open_hours: "-", address: "DPS Airport", coords: [-8.7481, 115.1670], note: "é£›å¾€é¦™æ¸¯ (HKG)ã€‚", tags: ["èˆªç­"] }
],
"inspiration": [],
"shopping": ["å…ç¨…åº—é¦™æ°´"]
}
};

let currentDay = "day1";
let modalMap = null;
let currentEventData = null;
// Setting default IDR rate: 10,000 IDR approx 5 HKD -> 1 IDR = 0.0005
let exchangeRate = 0.0005;
let weatherCache = null;

function init() {
renderDateSelector(); selectDay('day1');
switchMainPage('itinerary', document.querySelector('.nav-item.active'));
fetchRates(); fetchWeather();
if(localStorage.getItem('travelMemo')) document.getElementById('quick-memo').value = localStorage.getItem('travelMemo');
}

async function fetchRates(force = false) {
const statusEl = document.getElementById('rate-status');
statusEl.innerHTML = '<i class="fa-solid fa-sync fa-spin"></i> æ›´æ–°ä¸­...';

const cachedRate = localStorage.getItem('cachedRateIDR');
const cachedTime = localStorage.getItem('cachedRateTimeIDR');
const now = new Date().getTime();

if (!force && cachedRate && cachedTime && (now - cachedTime < 12 * 60 * 60 * 1000)) {
exchangeRate = parseFloat(cachedRate);
const dateObj = new Date(parseInt(cachedTime));
const dateStr = `${dateObj.getMonth()+1}/${dateObj.getDate()}`;
updateRateUI(exchangeRate, dateStr, true);
return;
}

try {
const res = await fetch('https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies/idr.json');
const data = await res.json();
if(data.idr && data.idr.hkd) {
exchangeRate = data.idr.hkd;
const apiDate = data.date;
localStorage.setItem('cachedRateIDR', exchangeRate);
localStorage.setItem('cachedRateTimeIDR', now);
updateRateUI(exchangeRate, apiDate, true);
convertCurrency();
}
} catch(e) {
console.error(e);
if(cachedRate) {
exchangeRate = parseFloat(cachedRate);
updateRateUI(exchangeRate, 'é›¢ç·š', false);
} else {
updateRateUI(exchangeRate, 'é è¨­', false);
}
}
}

function updateRateUI(rate, dateLabel, isSuccess) {
const statusEl = document.getElementById('rate-status');
const icon = isSuccess ? '<i class="fa-solid fa-check-circle" style="color:#25D366;"></i>' : '<i class="fa-solid fa-triangle-exclamation" style="color:orange;"></i>';
// Display rate for 10,000 IDR for easier reading
const readableRate = (rate * 10000).toFixed(2);
statusEl.innerHTML = `${icon} 10k IDR â‰ˆ ${readableRate} HKD`;
}

// --- Weather Module (Ubud) ---
async function fetchWeather() {
const lat = -8.5069; const lon = 115.2625; // Ubud
try {
const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=weathercode,temperature_2m_max,temperature_2m_min,precipitation_probability_max,sunrise,sunset,uv_index_max&timezone=auto&forecast_days=16`;
const res = await fetch(url);
weatherCache = await res.json();
if(document.getElementById('page-weather').classList.contains('active')) renderWeatherModule();
} catch(e) {
console.error("Weather Error", e);
document.getElementById('weather-content').innerHTML = "<div style='text-align:center; padding:30px;'>ç„¡æ³•è¼‰å…¥å¤©æ°£<br><span style='font-size:0.8rem; color:#888;'>è«‹æª¢æŸ¥ç¶²çµ¡é€£ç·š</span></div>";
}
}

function renderWeatherModule() {
const container = document.getElementById('weather-content');
const noticeEl = document.getElementById('weather-notice');

if(!weatherCache || !weatherCache.daily) {
container.innerHTML = "<div style='text-align:center; padding:30px;'>ç„¡å¤©æ°£è³‡æ–™</div>";
return;
}

const targetDate = scheduleData[currentDay].date;
const apiIndex = weatherCache.daily.time.indexOf(targetDate);

if (apiIndex === -1) {
container.innerHTML = `
<div style='text-align:center; padding:40px; color:#4A403A;'>
<i class="fa-regular fa-sun fa-2x" style="margin-bottom:15px; color:var(--accent-orange);"></i><br>
<div style="font-family:'Playfair Display'; font-size:1.2rem; margin-bottom:5px;">${scheduleData[currentDay].display}</div>
é æ¸¬æ°£æº«ï¼š30Â°C / 23Â°C<br>
<span style="font-size:0.8rem; color:#8D8178;">(æ­·å²å¹³å‡æ•¸æ“š - 9æœˆä¹¾å­£èˆ’é©)</span>
</div>`;
noticeEl.style.display = 'block';
noticeEl.innerHTML = `<i class="fa-solid fa-leaf"></i> 9æœˆç‚ºçƒå¸ƒä¹¾å­£ï¼Œæ—©æ™šæ¶¼çˆ½ï¼Œé©åˆæˆ¶å¤–æ´»å‹•ã€‚`;
return;
}

const d = weatherCache.daily;
const code = d.weathercode[apiIndex];
const max = d.temperature_2m_max[apiIndex];
const min = d.temperature_2m_min[apiIndex];
const rain = d.precipitation_probability_max[apiIndex];
const uv = d.uv_index_max[apiIndex];
const sunrise = d.sunrise[apiIndex].split('T')[1];
const sunset = d.sunset[apiIndex].split('T')[1];

const displayDate = scheduleData[currentDay].display;
const displayWeekday = scheduleData[currentDay].weekday;

const wmo = {
0: {icon: 'fa-sun', text: 'æ™´æœ— (Cerah)', color: '#FDB813'},
1: {icon: 'fa-cloud-sun', text: 'å¤šé›²', color: '#F39C12'},
2: {icon: 'fa-cloud-sun', text: 'å¤šé›²', color: '#F39C12'},
3: {icon: 'fa-cloud', text: 'é™°å¤©', color: '#95A5A6'},
51: {icon: 'fa-cloud-rain', text: 'æ¯›æ¯›é›¨', color: '#3498DB'},
61: {icon: 'fa-cloud-showers-heavy', text: 'é™£é›¨', color: '#2980B9'},
95: {icon: 'fa-bolt', text: 'é›·é›¨', color: '#8E44AD'}
};
const w = wmo[code] || {icon: 'fa-cloud', text: 'æœªçŸ¥', color: '#ccc'};

container.innerHTML = `
<div class="weather-main-card">
<div class="weather-date">${displayDate} (${displayWeekday}) â€¢ Ubud</div>
<div class="weather-icon-lg" style="color:${w.color}"><i class="fa-solid ${w.icon}"></i></div>
<div class="weather-temp-lg">${Math.round(max)}Â°</div>
<div class="weather-desc">${w.text} / ä½æº« ${Math.round(min)}Â°</div>
</div>
<div class="weather-grid">
<div class="weather-stat-card"><i class="fa-solid fa-droplet ws-icon"></i><span class="ws-label">é™é›¨æ©Ÿç‡</span><span class="ws-value">${rain}%</span></div>
<div class="weather-stat-card"><i class="fa-solid fa-sun ws-icon"></i><span class="ws-label">ç´«å¤–ç·š</span><span class="ws-value">${uv}</span></div>
<div class="weather-stat-card"><i class="fa-regular fa-clock ws-icon"></i><span class="ws-label">æ—¥å‡º</span><span class="ws-value">${sunrise}</span></div>
<div class="weather-stat-card"><i class="fa-solid fa-moon ws-icon"></i><span class="ws-label">æ—¥è½</span><span class="ws-value">${sunset}</span></div>
</div>
`;
noticeEl.style.display = 'block';
noticeEl.innerHTML = `<i class="fa-solid fa-satellite-dish"></i> å·²åŒæ­¥å³æ™‚é å ±ï¼šé¡¯ç¤ºå°æ‡‰ ${targetDate} ä¹‹æ•¸æ“š`;
}

// --- Logic ---
function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); document.getElementById('sidebar-overlay').classList.toggle('open'); }
function openTranslate() { window.open("https://translate.google.com/?sl=auto&tl=zh-TW", "_blank"); }

function navigateTo(pageId) {
toggleSidebar();
document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
document.getElementById('page-' + pageId).classList.add('active');
document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
document.querySelector('.date-selector-container').style.display = 'none';
}

function switchMainPage(pageId, navEl) {
document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
document.getElementById('page-' + pageId).classList.add('active');
document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
if(navEl) navEl.classList.add('active');
const ds = document.querySelector('.date-selector-container');
if(pageId === 'itinerary' || pageId === 'shopping' || pageId === 'inspiration' || pageId === 'weather') ds.style.display = 'block';
else ds.style.display = 'none';
if(pageId === 'weather') renderWeatherModule();
}

function convertCurrency() {
const idr = parseFloat(document.getElementById('curr-idr').value);
if(!isNaN(idr)) { document.getElementById('curr-hkd').value = (idr * exchangeRate).toFixed(2); } else { document.getElementById('curr-hkd').value = ""; }
}
function editRate() {
const newRate = prompt("æ‰‹å‹•è¨­å®šåŒ¯ç‡ (1 IDR å°å¤šå°‘ HKD):", exchangeRate);
if(newRate && !isNaN(newRate)) {
exchangeRate = parseFloat(newRate);
updateRateUI(exchangeRate, 'æ‰‹å‹•', false);
convertCurrency();
}
}
function saveMemo() { localStorage.setItem('travelMemo', document.getElementById('quick-memo').value); }

function sendWhatsApp() {
let phone = document.getElementById('wa-phone').value.replace(/\D/g, '');
if(!phone) { alert("è«‹è¼¸å…¥å°æ–¹é›»è©±è™Ÿç¢¼"); return; }
if (navigator.geolocation) {
navigator.geolocation.getCurrentPosition((pos) => {
const mapLink = `https://www.google.com/maps/search/?api=1&query=${pos.coords.latitude},${pos.coords.longitude}`;
const text = `æˆ‘ç¾åœ¨åœ¨çƒå¸ƒé€™è£¡ï¼Œä¸€åˆ‡å¹³å®‰ï¼\n${mapLink}`;
const url = `https://wa.me/${phone}?text=${encodeURIComponent(text)}`;
window.location.href = url;
}, () => { alert("ç„¡æ³•ç²å–ä½ç½®"); });
} else alert("ç€è¦½å™¨ä¸æ”¯æ´å®šä½");
}

function callNumber(num) { window.location.href = `tel:${num}`; }
function showPhrase(jp, zh) { document.getElementById('overlay-jp').innerText = jp; document.getElementById('overlay-zh').innerText = zh; document.getElementById('phrase-overlay').classList.add('active'); }
function closePhrase() { document.getElementById('phrase-overlay').classList.remove('active'); }

function renderDateSelector() {
const container = document.getElementById('date-selector'); container.innerHTML = '';
Object.keys(scheduleData).forEach(dayKey => {
const day = scheduleData[dayKey];
const chip = document.createElement('div'); chip.className = `date-chip`;
chip.onclick = () => selectDay(dayKey, chip);
chip.innerHTML = `<span class="day-num">${day.display}</span><span class="day-week">${day.weekday}</span>`;
container.appendChild(chip);
});
if(container.firstChild) container.firstChild.classList.add('active');
}

function selectDay(dayKey, chipEl) {
currentDay = dayKey;
if(chipEl) { document.querySelectorAll('.date-chip').forEach(c => c.classList.remove('active')); chipEl.classList.add('active'); chipEl.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' }); }
else {
const chips = document.querySelectorAll('.date-chip');
const index = parseInt(dayKey.replace('day', '')) - 1;
if(chips[index]) {
chips.forEach(c => c.classList.remove('active'));
chips[index].classList.add('active');
}
}
renderTimeline(dayKey); renderInspiration(dayKey); renderShopping(dayKey);
if(document.getElementById('page-weather').classList.contains('active')) renderWeatherModule();
}

function renderTimeline(dayKey) {
const container = document.getElementById('timeline-container'); container.innerHTML = '';
const events = scheduleData[dayKey].events || [];
if(events.length === 0) { container.innerHTML = `<div style="text-align:center; padding:40px; color:#AAA;">è‡ªç”±æ¢ç´¢çš„ä¸€å¤©</div>`; return; }
events.forEach(event => {
const item = document.createElement('div'); item.className = 'timeline-item';
let tags = event.tags.map(t => `<span class="card-tag">${t}</span>`).join('');
const navBtn = `<div class="card-nav-btn" onclick="event.stopPropagation(); openMapQuery('${event.address}')"><i class="fa-solid fa-location-arrow"></i></div>`;
item.innerHTML = `<div class="card" onclick='openModal(${JSON.stringify(event).replace(/'/g, "'")})'>${navBtn}<span class="card-time">${event.time}</span><h3 class="card-title">${event.title}</h3><div class="tags">${tags}</div></div>`;
container.appendChild(item);
});
container.appendChild(document.createElement('div')).style.height = "20px";
}
function renderInspiration(dayKey) {
const container = document.getElementById('inspiration-container'); container.innerHTML = '';
document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
document.querySelector('.filter-chip').classList.add('active');
(scheduleData[dayKey].inspiration || []).forEach(item => { container.innerHTML += `<div class="inspire-card" data-tag="${item.tag}"><div class="inspire-badge">${item.tag}</div><h3>${item.title}</h3><p style="margin:5px 0 0 0; font-size:0.9rem; color:#666;">${item.note}</p></div>`; });
}
function filterInspiration(tag, btn) {
document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active')); btn.classList.add('active');
document.querySelectorAll('.inspire-card').forEach(card => { if(tag === 'all' || card.getAttribute('data-tag') === tag) card.classList.remove('hidden'); else card.classList.add('hidden'); });
}
function renderShopping(dayKey) {
const container = document.getElementById('shopping-container'); container.innerHTML = '';
(scheduleData[dayKey].shopping || []).forEach((item, idx) => { container.innerHTML += `<div class="shop-item"><input type="checkbox" id="s${idx}"><label for="s${idx}">${item}</label></div>`; });
}

function openMapQuery(address) {
window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address)}`, '_blank');
}

function openModal(data) {
currentEventData = data;
document.getElementById('modal-title').innerText = data.title;
document.getElementById('modal-type').innerText = data.type;
document.getElementById('modal-time').innerText = data.time;
document.getElementById('modal-price').innerText = data.price;
document.getElementById('modal-open-hours').innerText = data.open_hours || "å¾…ç¢ºèª";
document.getElementById('modal-address-short').innerText = data.address;
document.getElementById('modal-note').innerText = data.note;
document.getElementById('modal-nav-link').onclick = function() { openMapQuery(data.address); };
const actionsContainer = document.getElementById('modal-actions');
actionsContainer.innerHTML = '';

// Customize Action Buttons based on type
if (data.type.includes('ç¾é£Ÿ') || data.type.includes('æ™šé¤') || data.type.includes('åˆé¤')) {
actionsContainer.innerHTML = `<button class="btn-action btn-black" onclick="searchGmail('${data.title}')">ğŸ“§ æœå°‹é ç´„ä¿¡ (Gmail)</button>`;
} else if (data.type.includes('SPA') || data.type.includes('æŒ‰æ‘©') || data.type.includes('é«”é©—') || data.type.includes('é¦™æ°›')) {
actionsContainer.innerHTML = `<button class="btn-action btn-black" onclick="searchGmail('${data.title}')">ğŸ“§ æœå°‹é ç´„ä¿¡ (Gmail)</button>`;
}

// Always add Taxi Card button
actionsContainer.innerHTML += `<button class="btn-action btn-black" style="margin-top:10px; background:var(--accent-green); color:white;" onclick="showPhrase('${data.address}', 'Pak Sopir, tolong antar saya ke sini.')">ğŸš• é¡¯ç¤ºåœ°å€ (çµ¦å¸æ©Ÿçœ‹)</button>`;

document.getElementById('detail-modal').classList.add('open');
setTimeout(() => { if(modalMap) modalMap.remove(); modalMap = L.map('modal-mini-map', {zoomControl:false, dragging:false}).setView(data.coords, 15); L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(modalMap); L.marker(data.coords, {icon: L.divIcon({className:'custom-div-icon',html:"<div style='background:#D37E42;width:14px;height:14px;border-radius:50%;border:2px solid white;box-shadow:0 2px 5px rgba(0,0,0,0.3);'></div>",iconSize:[14,14]})}).addTo(modalMap); modalMap.invalidateSize(); }, 100);
}
function closeModal() { document.getElementById('detail-modal').classList.remove('open'); }
document.getElementById('detail-modal').addEventListener('click', function(e) { if (e.target === this) closeModal(); });
function searchGmail(query) { window.open(`https://mail.google.com/mail/u/0/#search/${encodeURIComponent(query)}`, '_blank'); }

init();
</script>
</body>
</html>
